<!DOCTYPE html><html lang="zh-CN"><head><title>贺刘芳的搬砖日记</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="stylesheet" href="../../../../../layui/css/layui.css"><link rel="stylesheet" href="../../../../../css/common.css"><link rel="stylesheet" href="../../../../../css/post.css"><link rel="stylesheet" href="../../../../../lib/prism/prism.css"><link rel="shortcut icon" href="../../../../../img/favicon.ico"><link rel="stylesheet" href="../../../../../lib/iconfont/iconfont.css"><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="atom.xml" title="贺刘芳的搬砖日记" type="application/atom+xml">
</head><body style="overflow:hidden" data-prismjs-copy="复制" data-prismjs-copy-success="复制成功!"><div class="qy-nav"><ul class="layui-nav" lay-filter="" lay-bar="disabled" lay-unselect><li class="hide-xs layui-nav-item" id="searchBtn" style="float:right"><a class="searchBtn" href="javascript:void(0);"><i class="layui-icon layui-icon-search"></i> 搜索</a></li><li class="hide-xs layui-nav-item" style="float:right"><a target="_blank" rel="noopener" href="https://github.com/heliufang"><i class="icon iconfont icon-github"></i> github</a></li><li class="hide-xs layui-nav-item" style="float:right"><a target="_blank" rel="noopener" href="https://gitee.com/heliufang"><i class="icon iconfont icon-gitee"></i> gitee</a></li><li class="hide-xs layui-nav-item" style="float:right"><a target="_blank" rel="noopener" href="https://www.cnblogs.com/helf"><i class="icon iconfont icon-cnblogs"></i> 博客园</a></li><li class="layui-nav-item"><a class="title" href="/" style="padding:0"><i class="layui-anim layui-anim-rotate layui-anim-loop layui-icon layui-icon-star-fill"></i> 贺刘芳的笔记本</a></li><li class="hide-xs layui-nav-item" style="float:right"><a href="/about"><i class="layui-icon layui-icon-friends"></i> 关于</a></li><li class="hide-xs layui-nav-item" style="float:right"><a href="/archives"><i class="layui-icon layui-icon-date"></i> 归档</a></li><li class="hide-xs layui-nav-item" style="float:right"><a href="/tags"><i class="layui-icon layui-icon-note"></i> 标签</a></li><li class="hide-xs layui-nav-item" style="float:right"><a href="/categories"><i class="layui-icon layui-icon-template-1"></i> 分类</a></li><li class="hide-xs layui-nav-item" style="float:right"><a href="/"><i class="layui-icon layui-icon-home"></i> 首页</a></li><li class="layui-nav-item hide-sm hide-md hide-lg" style="float:right"><a href="javascript:;">菜单</a><dl class="layui-nav-child"><dd><a href="/">首页</a></dd><dd><a href="/archives">归档</a></dd><dd><a href="/tags">标签</a></dd><dd><a href="/categories">分类</a></dd><dd><a href="/about">关于</a></dd><dd><a target="_blank" rel="noopener" href="https://github.com/heliufang" title="github">github</a></dd><dd><a target="_blank" rel="noopener" href="https://gitee.com/heliufang" title="gitee">gitee</a></dd><dd><a target="_blank" rel="noopener" href="https://www.cnblogs.com/helf" title="博客园">博客园</a></dd><dd><a href="javascript:void(0)" onclick='document.querySelector("#searchShade").style.display="block"'>搜索</a></dd></dl></li></ul><div id="loadingBox" class="loadingBox"><img src="/img/loading.gif"></div></div><div id="searchShade" class="searchShade"><div id="searchLayer"><div id="closeBtn" class="close"><i class="layui-icon layui-icon-close"></i></div><input id="searchTxt" type="text" placeholder="搜索文章(只支持文章标题关键字)" autofocus><div id="searchResult"></div></div></div><div class="layui-container center" id="top"><div class="layui-row layui-col-space20"><div class="layui-col-md3 hide-xs hide-sm"><div class="layui-card"><div class="layui-card-header"><i style="font-weight:700" class="layui-icon layui-icon-speaker"></i> 公告</div><div class="layui-card-body"><div class="userinfo"><img src="/head.png"><div class="name">淡泊明志，宁静致远</div><div class="icons"><a target="_blank" rel="noopener" href="https://github.com/heliufang" title="github"><i class="icon iconfont icon-github"></i></a> <a target="_blank" rel="noopener" href="https://gitee.com/heliufang" title="gitee"><i class="icon iconfont icon-gitee"></i></a> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/helf" title="博客园"><i class="icon iconfont icon-cnblogs"></i></a></div><div class="other"><div class="item"><a class="title" style="color:#ff5722" href="/"><p class="num">40</p><div>文章</div></a></div><div class="item"><a style="color:#009688" href="/categories"><div class="num">8</div><div class="title">分类</div></a></div><div class="item"><a class="title" style="color:#01aaed" href="/tags"><div class="num">44</div><div>标签</div></a></div></div></div></div></div><div class="layui-card ahover"><div class="layui-card-header"><i style="font-weight:700" class="layui-icon layui-icon-website"></i> 网站资讯</div><div class="layui-card-body"><div class="webInfo-item"><div class="title">已运行时间</div><div class="content"><span id="runDays" data-since-date="2020-12-24"><i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"></i></span>天</div></div><div class="webInfo-item"><div class="title">本站文章字数合计</div><div class="content">200.8k</div></div><div class="webInfo-item"><div class="title">最后更新时间</div><div class="content" id="lastUpdate" data-last-update="2023-01-07 16:08:29"><i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"></i></div></div></div></div><div class="layui-card ahover"><div class="layui-card-header"><i style="font-weight:700" class="layui-icon layui-icon-time"></i> 最新文章</div><div class="layui-card-body"><ul><li><a href="/2022/12/30/1608754051799977984/images/">1.react笔记</a></li><li><a href="/2022/12/09/1601805950963027968/images/">2.vue3.2新特性笔记</a></li><li><a href="/2022/10/30/1593064784100724736/images/">3.node笔记</a></li><li><a href="/2022/07/09/1545789245413789696/images/">4.vue3笔记</a></li><li><a href="/2022/07/09/1551862167303753728/images/">5.TypeScript笔记</a></li></ul></div></div><div class="layui-card ahover"><div class="layui-card-header"><i style="font-weight:700" class="layui-icon layui-icon-template-1"></i> 文章分类</div><div class="layui-card-body left-a-color"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../../../../../categories/java/">java</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../../categories/linux/">linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../../categories/vue/">vue</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../../categories/web%E5%89%8D%E7%AB%AF/">web前端</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../../categories/%E5%85%AC%E4%BC%97%E5%8F%B7%E5%92%8C%E5%B0%8F%E7%A8%8B%E5%BA%8F/">公众号和小程序</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../../categories/%E5%85%B6%E5%AE%83%E6%8A%80%E6%9C%AF/">其它技术</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../../categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/">开发工具</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../../categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><span class="category-list-count">2</span></li></ul></div></div><div style="height:calc(100% - 60px - 60px);width:267px" id="toc-area" class="layui-card ahover"><div class="layui-card-header"><i class="layui-icon layui-icon-align-center"></i> 本文目录</div><div id="tocMain" class="layui-card-body" style="overflow:auto;height:calc(100% - 60px - 60px)"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E4%BD%93%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88"><span class="toc-text">总体实现方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%BC%96%E5%86%99%E6%A8%A1%E6%9D%BF"><span class="toc-text">1 编写模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E7%94%9F%E6%88%90%E5%B8%A6%E6%95%B0%E6%8D%AE%E7%9A%84html%E6%96%87%E4%BB%B6"><span class="toc-text">2 模板引擎生成带数据的html文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E9%80%9A%E8%BF%87wkhtmltopdf%E5%B0%86%E7%94%9F%E6%88%90%E7%9A%84html%E6%96%87%E4%BB%B6%E8%BD%AC%E6%88%90pdf%E6%96%87%E4%BB%B6"><span class="toc-text">3 通过wkhtmltopdf将生成的html文件转成pdf文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E4%B8%8B%E8%BD%BDwkhtmltopdf"><span class="toc-text">3.1 下载wkhtmltopdf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%AE%89%E8%A3%85wkhtmltopdf"><span class="toc-text">3.2 安装wkhtmltopdf</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-windows%E5%AE%89%E8%A3%85"><span class="toc-text">3.2.1 windows安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-centos7-linux%E5%AE%89%E8%A3%85"><span class="toc-text">3.2.2 centos7-linux安装</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%B0%81%E8%A3%85%E4%B8%80%E4%B8%AAhtml%E8%BD%ACpdf%E7%9A%84%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-text">3.3 封装一个html转pdf的工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-wkhtmltopdf%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93"><span class="toc-text">3.4 wkhtmltopdf的一些问题总结</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-1-%E5%BC%BA%E5%88%B6%E5%88%86%E9%A1%B5%E9%97%AE%E9%A2%98"><span class="toc-text">3.4.1 强制分页问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-2-%E6%AF%8F%E9%A1%B5%E6%98%BE%E7%A4%BA%E8%A1%A8%E5%A4%B4"><span class="toc-text">3.4.2 每页显示表头</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-3-%E8%A1%A8%E6%A0%BC%E5%88%86%E9%A1%B5%E6%97%B6%E8%A1%8C%E5%86%85%E5%AE%B9%E8%A2%AB%E6%88%AA%E6%96%AD%E9%97%AE%E9%A2%98"><span class="toc-text">3.4.3 表格分页时行内容被截断问题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E7%BB%99pdf%E7%9A%84%E6%AF%8F%E4%B8%80%E9%A1%B5%E9%83%BD%E5%8A%A0%E4%B8%8A%E6%96%87%E5%AD%97%E6%B0%B4%E5%8D%B0%E5%92%8C%E9%A1%B5%E7%A0%81"><span class="toc-text">4 给pdf的每一页都加上文字水印和页码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-text">参考</span></a></li></ol></div><div class="readprocess"><div><i class="layui-icon layui-icon-read"></i> 已阅读：<span id="progressTxt"></span>%</div><div class="layui-progress" lay-filter="demo"><div class="layui-progress-bar" lay-percent="10%"></div></div></div></div></div><div class="layui-col-md9 markdown-body" style="background:#fff;margin-top:10px"><div class="article-title"><h1>java生成pdf并加水印(通过wkhtmltopdf实现)</h1><p><i class="layui-icon layui-icon-survey"></i>发表于:2021-08-03 | <i class="layui-icon layui-icon-app"></i>字数:2.5k</p></div><div id="article"><p>公司项目有个需求就是根据模板动态的生成pdf文件,在网上看过很多方式生成的效果都不是很好。要么样式不支持，要么字体不支持。我这边项目的需求是这样：</p><pre><code>1.根据模板生成纸张方向为横向的pdf
2.给pdf的每一页中间的位置都加上文字水印
</code></pre><p>研究了很久终于实现了效果，效果如下图所示：</p><p><img src="/2021/08/03/1426392656254210048/images/image-20210801204853727.png" alt="image-20210801204853727"></p><h2 id="总体实现方案"><a href="#总体实现方案" class="headerlink" title="总体实现方案"></a>总体实现方案</h2><ul><li><p>准备好html模板 —&gt;就是写html,注意：样式少用css3的，并且不要使用外部样式.可以把样式写在style标签内部,也就是保证样式和html标签在同一个html文件中。</p></li><li><p>通过模板引擎将html模板生成含数据的html —&gt; 使用<code>beetl</code>模板引擎实现,当然你也可以用<code>freemarker</code>等模板引擎实现</p></li><li><p>把生成的html转成pdf—&gt;通过<code>wkhtmltopdf</code>这个程序实现</p></li><li><p>最后把生成的pdf文件加上水印—&gt;通过<code>itex</code>t实现</p></li></ul><h2 id="1-编写模板"><a href="#1-编写模板" class="headerlink" title="1 编写模板"></a>1 编写模板</h2><p>模板如下,其实就是写html文件，可以看到<code>$&#123;xxx&#125;</code>这种占位符,这些数据都是动态的，用来给模板引擎识别的。</p><p><img src="/2021/08/03/1426392656254210048/images/image-20210801205236360.png" alt="image-20210801205236360"></p><h2 id="2-模板引擎生成带数据的html文件"><a href="#2-模板引擎生成带数据的html文件" class="headerlink" title="2 模板引擎生成带数据的html文件"></a>2 模板引擎生成带数据的html文件</h2><p>因为公司项目用的是<code>beetl</code>模板引擎所以我这里也就用beetl生成html文件.你也可以用其它的模板引擎生成,比如<code>freemarker</code>。如果这两个都不会，那就先去学习一下吧，O(∩_∩)O哈哈~,其实不难，这两个模板引擎的语法和jsp的语法很像。</p><p>beetl官网：<a target="_blank" rel="noopener" href="https://www.kancloud.cn/xiandafu/beetl3_guide/2138944">https://www.kancloud.cn/xiandafu/beetl3_guide/2138944</a></p><p>freemarker官网：<a target="_blank" rel="noopener" href="http://freemarker.foofun.cn/">http://freemarker.foofun.cn/</a></p><p>beetl的maven依赖如下：</p><pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.ibeetl&lt;/groupId&gt;
    &lt;artifactId&gt;beetl&lt;/artifactId&gt;
    &lt;version&gt;3.1.8.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><p>大致代码如下：这里需要根据你自己的模板进行修改</p><pre><code class="java">public static void fileResourceLoaderTest() throws Exception&#123;
        String root = System.getProperty(&quot;user.dir&quot;)+File.separator+&quot;template&quot;;
        //System.out.println(root);
        FileResourceLoader resourceLoader = new FileResourceLoader(root,&quot;utf-8&quot;);
        Configuration cfg = Configuration.defaultConfiguration();
        GroupTemplate gt = new GroupTemplate(resourceLoader, cfg);
        //准备模板需要的动态数据
        Map map = new HashMap();//给模板的数据
        map.put(&quot;address&quot;, &quot;清远市清城区横荷清远大道55号&quot;);
        //通过模板位置构建模板对象
        Template t = gt.getTemplate(&quot;/s01/order.html&quot;);
        //将数据和模板绑定,
        t.binding(map);
        String str = t.render();
        System.out.println(str);
        //生成html文件
        FileWriter writer = new FileWriter(&quot;C:\\Users\\Administrator\\Desktop\\a\\1.html&quot;);
        writer.write(str);
    &#125;
</code></pre><h2 id="3-通过wkhtmltopdf将生成的html文件转成pdf文件"><a href="#3-通过wkhtmltopdf将生成的html文件转成pdf文件" class="headerlink" title="3 通过wkhtmltopdf将生成的html文件转成pdf文件"></a>3 通过wkhtmltopdf将生成的html文件转成pdf文件</h2><p><code>wkhtmltopdf</code>是一个程序,具体来说就是一个软件,也是生成pdf的关键技术。可以在java程序中调用这个软件来把html文件转成pdf文件。我对比了很多方案,我认为<code>wkhtmltopdf</code>是目前来说比较好的一种方案。</p><h3 id="3-1-下载wkhtmltopdf"><a href="#3-1-下载wkhtmltopdf" class="headerlink" title="3.1 下载wkhtmltopdf"></a>3.1 下载wkhtmltopdf</h3><p>官网下载地址：<a target="_blank" rel="noopener" href="https://wkhtmltopdf.org/downloads.html">https://wkhtmltopdf.org/downloads.html</a></p><p>根据自己的需要下载相应的版本即可</p><p><img src="/2021/08/03/1426392656254210048/images/image-20210802230511892.png" alt="image-20210802230511892"></p><h3 id="3-2-安装wkhtmltopdf"><a href="#3-2-安装wkhtmltopdf" class="headerlink" title="3.2 安装wkhtmltopdf"></a>3.2 安装wkhtmltopdf</h3><p>下载下来的安装包如下：</p><p><img src="/2021/08/03/1426392656254210048/images/image-20210802230435552.png" alt="image-20210802230435552"></p><h4 id="3-2-1-windows安装"><a href="#3-2-1-windows安装" class="headerlink" title="3.2.1 windows安装"></a>3.2.1 windows安装</h4><p>windows安装比较简单,一直点击下一步即可</p><p>装好之后可以使用cmd命令行来运行</p><p>在装好的路径下右键—&gt;打开命令窗口：</p><p><img src="/2021/08/03/1426392656254210048/images/image-20210802232012602.png" alt="image-20210802232012602"></p><p>命令格式：</p><pre><code>wkhtmltopdf.exe https://wkhtmltopdf.org/downloads.html c:\1.pdf
</code></pre><p><img src="/2021/08/03/1426392656254210048/images/image-20210802232308095.png" alt="image-20210802232308095"></p><p>可以看到其实就是把<a target="_blank" rel="noopener" href="https://wkhtmltopdf.org/downloads.html%E8%BF%99%E4%B8%AA%E7%BD%91%E9%A1%B5%E5%9C%A8c%E7%9B%98%E4%B8%8B%E7%94%9F%E6%88%901.pdf">https://wkhtmltopdf.org/downloads.html这个网页在c盘下生成1.pdf</a></p><p><img src="/2021/08/03/1426392656254210048/images/image-20210802232335699.png" alt="image-20210802232335699"></p><p>当然也可以把本地的html文件转成pdf,比如：</p><pre><code>wkhtmltopdf.exe c:\1.html c:\1.pdf
</code></pre><p>这样生成的pdf默认是竖向的,但是公司项目需求是横向的所以要加上参数 <code>-O landscape</code></p><pre><code>wkhtmltopdf -O landscape c:\1.html c:\1.pdf
</code></pre><p>其它参数配置可以看看这个博客：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenjunwu/p/12792708.html">wkhtmltopdf 参数 详解</a></p><h4 id="3-2-2-centos7-linux安装"><a href="#3-2-2-centos7-linux安装" class="headerlink" title="3.2.2 centos7-linux安装"></a>3.2.2 centos7-linux安装</h4><ul><li>首先需要安装以下依赖：</li></ul><pre><code class="shell">yum install libX11
yum install libXext
yum install libXrender
yum install libjpeg
yum install xorg-x11-fonts-75dpi
yum install xorg-x11-fonts-Type1
</code></pre><ul><li>然后执行安装命令</li></ul><pre><code class="shell">rpm -ivh wkhtmltox-0.12.6-1.centos7.x86_64.rpm
</code></pre><p>至此linux上就安装好了,linux的运行wkhtmltopdf和windows类似</p><p>比如将当前目录下的<code>1.html</code>转成<code>1.pdf</code></p><pre><code class="sh">/opt/wkhtmltopdf/bin/wkhtmltopdf -O landscape .\1.html .\1.pdf
</code></pre><p><code>/opt/wkhtmltopdf/bin/wkhtmltopdf</code>其实就是装好之后的路径,可以通过find命令查出来.每台linux的服务器可能不一样,所以要查一下。</p><pre><code class="shell">find / -name &#39;wkhtmltopdf&#39;
</code></pre><p>比如我查出来的结果如下：</p><p><img src="/2021/08/03/1426392656254210048/images/image-20210802234806791.png" alt="image-20210802234806791"></p><h3 id="3-3-封装一个html转pdf的工具类"><a href="#3-3-封装一个html转pdf的工具类" class="headerlink" title="3.3 封装一个html转pdf的工具类"></a>3.3 封装一个html转pdf的工具类</h3><pre><code class="java">public class WKHtmlToPdfUtil &#123;
    
    /**
     *       测试
     * @param args
     * @throws Exception
     */
    public static void main(String[] args) throws Exception&#123;
        htmlToPdf(&quot;https://www.baidu.com&quot;,&quot;d:\\1.pdf&quot;);
    &#125;

    /**
     * 获取windows和linux调用wkhtmltopdf程序的命令
     * @param sourceFilePath
     * @param targetFilePath
     * @return
     */
    public static String getCommand(String sourceFilePath, String targetFilePath) &#123;
        String system = System.getProperty(&quot;os.name&quot;);
        if(system.contains(&quot;Windows&quot;)) &#123;
            System.out.println(&quot;windows&quot;);
            //-O landscape 表示纸张方向为横向  默认为纵向  如果要生成横向那么去掉-O landscape即可
            return &quot;C:\\Program Files\\wkhtmltopdf\\bin\\wkhtmltopdf.exe -O landscape &quot; + sourceFilePath + &quot; &quot; + targetFilePath;
        &#125;else if(system.contains(&quot;Linux&quot;)) &#123;
            System.out.println(&quot;linux&quot;);
            return &quot;/usr/local/bin/wkhtmltopdf -O landscape &quot; + sourceFilePath + &quot; &quot; + targetFilePath;
        &#125;
        return &quot;&quot;;
    &#125;
    
    /**
     * html转pdf
     * @param sourceFilePath
     * @param targetFilePath
     * @return
     */
    public static boolean htmlToPdf(String sourceFilePath, String targetFilePath) &#123;
        try &#123;
            System.out.println(&quot;转化开始&quot;);
            String command = WKHtmlToPdfUtil.getCommand(sourceFilePath, targetFilePath);
            System.out.println(&quot;command:&quot;+command);
            Process process = Runtime.getRuntime().exec(command);
            process.waitFor();  //这个调用比较关键，就是等当前命令执行完成后再往下执行
            System.out.println(&quot;html--&gt;pdf:success&quot;);
            return true;
        &#125; catch (Exception e) &#123;
            e.printStackTrace();
            System.out.println(&quot;html--&gt;pdf:error&quot;);
            return false;
        &#125;
    &#125;
&#125;
</code></pre><h3 id="3-4-wkhtmltopdf的一些问题总结"><a href="#3-4-wkhtmltopdf的一些问题总结" class="headerlink" title="3.4 wkhtmltopdf的一些问题总结"></a>3.4 wkhtmltopdf的一些问题总结</h3><h4 id="3-4-1-强制分页问题"><a href="#3-4-1-强制分页问题" class="headerlink" title="3.4.1 强制分页问题"></a>3.4.1 强制分页问题</h4><p>添加样式，使用样式的容器将会独占一页，如果分页最后一页也会独占一页,给div容器加上以下样式即可。</p><pre><code class="css">page-break-after: always !important;
</code></pre><h4 id="3-4-2-每页显示表头"><a href="#3-4-2-每页显示表头" class="headerlink" title="3.4.2 每页显示表头"></a>3.4.2 每页显示表头</h4><pre><code class="css">thead &#123;
     display:table-header-group;/* 给thead加上这行保证每页都会带上表头 */
&#125;
</code></pre><p>给thead加上这行保证每页都会带上表头，同时也会解决表头与内容重叠问题.</p><p>如果仍然存在表头和内容重叠问题,一般是因为表格的一行的内容超过一页。我就遇到过这种问题，我的解决方案是用js缩放页面。</p><pre><code class="js">document.getElementsByTagName(&#39;body&#39;)[0].style.zoom=0.6;//0.6为缩放的比例
</code></pre><h4 id="3-4-3-表格分页时行内容被截断问题"><a href="#3-4-3-表格分页时行内容被截断问题" class="headerlink" title="3.4.3 表格分页时行内容被截断问题"></a>3.4.3 表格分页时行内容被截断问题</h4><p>给表格tbody的tr标签加上这个样式</p><pre><code class="css">tbody tr&#123;
    page-break-inside: avoid !important;
&#125;
</code></pre><h2 id="4-给pdf的每一页都加上文字水印和页码"><a href="#4-给pdf的每一页都加上文字水印和页码" class="headerlink" title="4 给pdf的每一页都加上文字水印和页码"></a>4 给pdf的每一页都加上文字水印和页码</h2><p>如果你的项目没有这个需求可以不看这部分</p><p>maven坐标如下：</p><pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.lowagie&lt;/groupId&gt;
    &lt;artifactId&gt;itextasian&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.lowagie&lt;/groupId&gt;
    &lt;artifactId&gt;itext&lt;/artifactId&gt;
    &lt;version&gt;2.1.7&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><p>其中<code>itextasian</code>这个maven仓库默认是没有的,需要手动添加到自己的maven仓库</p><p>我上传到百度云了：</p><p>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1bN3MTRjzlQaqzF5FpfpySg">https://pan.baidu.com/s/1bN3MTRjzlQaqzF5FpfpySg</a><br>提取码：ijgf</p><p>下载下来后将<code>lowagie.rar</code> 中的 <code>lowagie</code> 文件夹 直接拷贝到本地仓库的com文件夹下面即可</p><p><img src="/2021/08/03/1426392656254210048/images/image-20210803232811879.png" alt="image-20210803232811879"></p><p>demo代码如下</p><pre><code class="java">import java.awt.Color;
import java.io.BufferedOutputStream;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import org.junit.Test;
import com.lowagie.text.DocumentException;
import com.lowagie.text.Element;
import com.lowagie.text.Image;
import com.lowagie.text.pdf.BaseFont;
import com.lowagie.text.pdf.PdfContentByte;
import com.lowagie.text.pdf.PdfGState;
import com.lowagie.text.pdf.PdfReader;
import com.lowagie.text.pdf.PdfStamper;

public class PDFAddWaterMart&#123;
    
    @Test
    public void addTextMart() throws Exception&#123;
        // 要输出的pdf文件
        BufferedOutputStream bos = new BufferedOutputStream(new FileOutputStream(new File(&quot;C:\\result1.pdf&quot;)));
        // 将pdf文件先加水印然后输出
        setWatermarkText(bos, &quot;C:\\input.pdf&quot;,&quot;壹新设计报价云平台&quot;);
    &#125;
    
    //@Test
    public void addImageMart() throws Exception&#123;
        // 要输出的pdf文件
        BufferedOutputStream bos = new BufferedOutputStream(new FileOutputStream(new File(&quot;C:\\result2.pdf&quot;)));
        Calendar cal = Calendar.getInstance();
        SimpleDateFormat format = new SimpleDateFormat(&quot;yyyy-MM-dd hh:mm:ss&quot;);
        // 将pdf文件先加水印然后输出
        setWatermarkImage(bos, &quot;C:\\input.pdf&quot;, format.format(cal.getTime()) + &quot;  下载使用人：&quot; + &quot;测试user&quot;, 16);
    &#125;
    
    
    /**
     * 设置文字水印
     * @param bos
     * @param input
     * @param text
     * @throws DocumentException
     * @throws IOException
     */
    public static void setWatermarkText(BufferedOutputStream bos, String input,String text)
            throws DocumentException, IOException &#123;
        PdfReader reader = new PdfReader(input);
        PdfStamper stamper = new PdfStamper(reader, bos);
        int total = reader.getNumberOfPages()+1;
        PdfContentByte content;
        BaseFont base = BaseFont.createFont(&quot;STSong-Light&quot;, &quot;UniGB-UCS2-H&quot;, BaseFont.EMBEDDED);
        PdfGState gs1 = new PdfGState();
        gs1.setFillOpacity(0.2f);//设置透明度
        PdfGState gs2 = new PdfGState();
        gs2.setFillOpacity(1f);
        for (int i = 1; i &lt; total; i++) &#123;
            content = stamper.getOverContent(i);// 在内容上方加水印
            //content = stamper.getUnderContent(i);//在内容下方加水印
            //水印内容
            content.setGState(gs1);
            content.beginText();
            content.setColorFill(Color.GRAY);
            content.setFontAndSize(base, 50);
            content.setTextMatrix(70, 200);
            //350为x坐标 350y坐标  45为旋转45度
            content.showTextAligned(Element.ALIGN_CENTER, text, 350, 350, 45);
            content.endText();//结束文字
            //页脚内容
            content.setGState(gs2);
            content.beginText();
            content.setColorFill(Color.BLACK);
            content.setFontAndSize(base, 8);
            content.setTextMatrix(70, 200);
            content.showTextAligned(Element.ALIGN_CENTER, &quot;壹新设计报价云平台 www.newbeall.com 第&quot;+i+ &quot;页,共&quot;+(total-1)+&quot;页&quot;, 370, 10, 0);
            content.endText();
        &#125;
        stamper.close();
    &#125;
    
    /**
     * 设置图片水印
     * @param bos输出文件的位置
     * @param input
     *            原PDF位置
     * @param waterMarkName
     *            页脚添加水印
     * @param permission
     *            权限码
     * @throws DocumentException
     * @throws IOException
     */
    public static void setWatermarkImage(BufferedOutputStream bos, String input, String waterMarkName, int permission)
            throws DocumentException, IOException &#123;
        
        
        PdfReader reader = new PdfReader(input);
        PdfStamper stamper = new PdfStamper(reader, bos);
        
        int total = reader.getNumberOfPages() + 1;
        PdfContentByte content;
        BaseFont base = BaseFont.createFont(&quot;STSong-Light&quot;, &quot;UniGB-UCS2-H&quot;, BaseFont.EMBEDDED);
        PdfGState gs = new PdfGState();
        for (int i = 1; i &lt; total; i++) &#123;
            content = stamper.getOverContent(i);// 在内容上方加水印
            // content = stamper.getUnderContent(i);//在内容下方加水印
            gs.setFillOpacity(0.2f);
            // content.setGState(gs);
            content.beginText();
            content.setColorFill(Color.LIGHT_GRAY);
            content.setFontAndSize(base, 50);
            content.setTextMatrix(70, 200);
            //这里的水印图片换成你自己的
            Image image = Image.getInstance(&quot;C:\\Users\\Administrator\\Desktop\\quotation12.png&quot;);
            /*
              img.setAlignment(Image.LEFT | Image.TEXTWRAP);
              img.setBorder(Image.BOX); img.setBorderWidth(10);
              img.setBorderColor(BaseColor.WHITE); img.scaleToFit(100072);//大小
              img.setRotationDegrees(-30);//旋转
             */
            image.setAbsolutePosition(200, 206); // set the first background
            image.scaleToFit(200, 200);// image of the absolute
            image.setRotationDegrees(45);//旋转45度
            content.addImage(image);
            content.setColorFill(Color.BLACK);
            content.setFontAndSize(base, 8);
            content.showTextAligned(Element.ALIGN_CENTER, &quot;下载时间：&quot; + waterMarkName + &quot;&quot;, 300, 10, 0);
            content.endText();

        &#125;
        stamper.close();
    &#125;
&#125;
</code></pre><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wangsen/p/9329687.html">java生成pdf</a></p><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/chenjunwu/p/12792708.html">wkhtmltopdf 参数 详解</a></p><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/qlqwjy/p/9326468.html">Java给图片和PDF文件添加水印(图片水印和文字水印)</a></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_33745005/article/details/89970979">maven项目中使用itextasian</a></p><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/daxiongblog/p/12963501.html">使用 wkhtmltopdf 导出时遇到的问题</a></p></div><div class="post-ending"><div class="end-txt">------ 本文结束，感谢您的阅读 ------</div><blockquote class="layui-elem-quote layui-quote-nm"><div><span class="title">本文作者: </span>贺刘芳</div><div><span class="title">本文链接: </span><a target="_blank" href="https://heliufang.github.io/2021/08/03/1426392656254210048/images/">https://heliufang.github.io/2021/08/03/1426392656254210048/images/</a></div><div><span class="title">版权声明: </span>本文采用知识共享署名-非商业性使用-禁止演绎 2.5 中国大陆许可协议进行许可。</div></blockquote></div></div></div></div><ul id="toTopBtn" class="layui-fixbar" style="right:-70px" title="置顶"><div><a href="javascript:void(0)" class="icon iconfont icon-huojian"></a></div></ul><div class="qy-footer"><div class="font-Area"><p>Copyright © 2020 ~<span id="currentYear">2022</span> <span class="layui-icon layui-icon-heart-fill footer-heart"></span> HeLiuFang</p><p>由 <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a> <span style="color:red" class="layui-icon layui-icon-find-fill layui-anim layui-anim-rotate layui-anim-loop"></span> 强力驱动</p><p>访客数 <span style="color:red" id="busuanzi_value_site_uv"><i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"></i></span> 人次 | 访问量 <span style="color:red" id="busuanzi_value_site_pv"><i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"></i></span> 次 | 本站已运行 <span style="color:red" id="runDaysFooter"><i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"></i></span> 天 | 本站文章字数合计 <span style="color:red">200.8k</span> | 最后更新于 <span style="color:red" id="lastUpdateFooter"><i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"></i></span></p></div></div></body><script src="../../../../../js/jquery.min.js"></script><script src="../../../../../js/moment.min.js"></script><script src="../../../../../layui/layui.js"></script><script src="../../../../../lib/prism/prism.js"></script><script>$("#searchBtn").click(function(){$("#searchShade").show(),$("#searchLayer").addClass("layui-anim layui-anim-scaleSpring")}),$("#closeBtn").click(function(){$("#searchShade").hide()});var searchFunc=function(e,o,a){$.ajax({url:e,dataType:"json",success:function(e){var t=document.getElementById(o),n=document.getElementById(a);t.addEventListener("input",function(){var t='<ul class="search-result-list">',a=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length<=0||(e.forEach(function(e){var n=!0,o=e.title.trim().toLowerCase(),e=e.url;""!=o&&a.forEach(function(e,t){o.indexOf(e)<0?n=!1:o=o.replace(new RegExp(e,"g"),'<span style="color:red">'+e+"</span>")}),n&&(t=t+"<li><a href='"+e+"' class='search-result-title'>"+o+"</a></li>")}),t+="</ul>",n.innerHTML=t)})}})};function DynamicLine(){function e(e,t,n){return e.getAttribute(t)||n}function t(e){return document.getElementsByTagName(e)}function n(){s=a.width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,r=a.height=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}function c(){var n,o,a,i,l;m.clearRect(0,0,s,r),y.forEach(function(e,t){for(e.x+=e.xa,e.y+=e.ya,e.xa*=e.x>s||e.x<0?-1:1,e.ya*=e.y>r||e.y<0?-1:1,m.fillRect(e.x-.5,e.y-.5,1,1),o=t+1;o<d.length;o++)null!==(n=d[o]).x&&null!==n.y&&(a=e.x-n.x,i=e.y-n.y,(l=a*a+i*i)<n.max)&&(n===h&&l>=n.max/2&&(e.x-=.03*a,e.y-=.03*i),a=(n.max-l)/n.max,m.beginPath(),m.lineWidth=a/2,m.strokeStyle="rgba("+u.c+","+(.2+a)+")",m.moveTo(e.x,e.y),m.lineTo(n.x,n.y),m.stroke())}),w(c)}var s,r,d,o,a=document.createElement("canvas"),u=(i=(o=t("script")).length,o=o[i-1],{l:i,z:e(o,"zIndex",-1),o:e(o,"opacity",.5),c:e(o,"color","0,0,50"),n:e(o,"count",99)}),i="c_n"+u.l,m=a.getContext("2d"),w=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/45)},l=Math.random,h={x:null,y:null,max:2e4};a.id=i,a.style.cssText="position:fixed;top:0;left:0;z-index:"+u.z+";opacity:"+u.o,t("body")[0].appendChild(a),n(),window.onresize=n,window.onmousemove=function(e){e=e||window.event,h.x=e.clientX,h.y=e.clientY},window.onmouseout=function(){h.x=null,h.y=null};for(var y=[],p=0;p<u.n;p++){var x=l()*s,f=l()*r,$=2*l()-1,v=2*l()-1;y.push({x:x,y:f,xa:$,ya:v,max:6e3})}d=y.concat([h]),setTimeout(function(){c()},100)}searchFunc("/search.json","searchTxt","searchResult"),DynamicLine(),document.querySelector("#currentYear").innerText=(new Date).getFullYear();var days=moment().diff($("#runDays")[0].dataset.sinceDate,"days"),lastUpdate=($("#runDays").html(days),$("#runDaysFooter").html(days),moment($("#lastUpdate")[0].dataset.lastUpdate,"YYYY-MM-DD HH:mm:ss").locale("zh-CN").fromNow());$("#lastUpdate").html(lastUpdate),$("#lastUpdateFooter").html(lastUpdate),$("#toTopBtn").click(function(){var e=$(window).scrollTop(),t=parseInt(e/60),n=setInterval(function(){console.log("toTopBtn...setInterval",$(window).scrollTop()),$(window).scrollTop($(window).scrollTop()-t),0===$(window).scrollTop()&&clearInterval(n)},1)}),$.event.add(window,"scroll",function(){$("#toTopBtn").css("transform",0<$(window).scrollTop()?"translateX(-85px)":"translateX(85px)"),$("#toTopBtn").css("transition","all 0.5s")}),$("#loadingBox").hide(),$("body").css("overflow","auto")</script><script>function clickEffect(){let s=[],i=!1,e,n=0,o,d,l,t,h;const r=["#F73859","#14FFEC","#00E0FF","#FF99FE","#FAF15D"],a=document.createElement("canvas"),c=(document.body.appendChild(a),a.setAttribute("style","width: 100%; height: 100%; top: 0; left: 0; z-index: 99999; position: fixed; pointer-events: none;"),document.createElement("span"));function u(){a.width=2*window.innerWidth,a.height=2*window.innerHeight,a.style.width=window.innerWidth+"px",a.style.height=window.innerHeight+"px",h.scale(2,2),o=a.width=window.innerWidth,d=a.height=window.innerHeight,l={x:o/2,y:d/2},t={x:o/2,y:d/2}}c.classList.add("pointer"),document.body.appendChild(c),a.getContext&&window.addEventListener?(h=a.getContext("2d"),u(),window.addEventListener("resize",u,!1),function t(){h.fillStyle="rgba(255, 255, 255, 0)";h.clearRect(0,0,a.width,a.height);for(let e=0;e<s.length;e++){let t=s[e];t.r<0||(h.fillStyle=t.color,h.beginPath(),h.arc(t.x,t.y,t.r,0,2*Math.PI,!1),h.fill(),t.update())}1==i?n+=.2:!i&&0<=n&&(n-=.4);y();requestAnimationFrame(t)}(),window.addEventListener("mousedown",function(t){m(p(10,20),t.clientX,t.clientY),document.body.classList.add("is-pressed"),e=setTimeout(function(){document.body.classList.add("is-longpress"),i=!0},500)},!1),window.addEventListener("mouseup",function(t){clearInterval(e),1==i&&(document.body.classList.remove("is-longpress"),m(p(50+Math.ceil(n),100+Math.ceil(n)),t.clientX,t.clientY),i=!1),document.body.classList.remove("is-pressed")},!1),window.addEventListener("mousemove",function(t){var e=t.clientX,t=t.clientY;c.style.top=t+"px",c.style.left=e+"px"},!1)):console.log("canvas or addEventListener is unsupported!");class w{constructor(t=l.x,e=l.y){this.x=t,this.y=e,this.angle=2*Math.PI*Math.random(),1==i?this.multiplier=p(14+n,15+n):this.multiplier=p(6,12),this.vx=(this.multiplier+.5*Math.random())*Math.cos(this.angle),this.vy=(this.multiplier+.5*Math.random())*Math.sin(this.angle),this.r=p(8,12)+3*Math.random(),this.color=r[Math.floor(Math.random()*r.length)]}update(){this.x+=this.vx-t.x,this.y+=this.vy-t.y,t.x=-2/window.innerWidth*Math.sin(this.angle),t.y=-2/window.innerHeight*Math.cos(this.angle),this.r-=.3,this.vx*=.9,this.vy*=.9}}function m(e=1,i=l.x,n=l.y){for(let t=0;t<e;t++)s.push(new w(i,n))}function p(t,e){return Math.floor(Math.random()*e)+t}function y(){for(let t=0;t<s.length;t++){var e=s[t];(e.x+e.r<0||e.x-e.r>o||e.y+e.r<0||e.y-e.r>d||e.r<0)&&s.splice(t,1)}}}clickEffect()</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>var element=null;layui.use(["element"],function(){element=layui.element}),$(function(){var e=$("#toc-area"),t=$(e).offset().top;$.event.add(window,"scroll",function(){var o=$(".markdown-body").height(),o=(($(window).scrollTop()+t)/o*100).toFixed(2);element.progress("demo",(o=0==(o=99<o?100:o)?0:o)+"%"),$("#progressTxt").text(o),console.log("percent",o),$(e).css("position",$(window).scrollTop()>t?"fixed":"static"),$(e).css("top",$(window).scrollTop()>t?"60px":""),$("#tocMain").scrollTop($("#tocMain .toc").height()*o*.01)}),$("pre code").each(function(){var o=$(this).attr("class");o="language-"+(null==o||""==o||null==o?"plaintext":o),$(this).attr("class",o)}),$("pre").prepend('<div class="copy-to-clipboard-button"></div>')})</script></html>